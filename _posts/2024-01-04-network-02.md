---
title: 네트워크 통신
date: 2024-01-06
categories: ["NETWORK"]
tags: ['networking']     # TAG names should always be lowercase
toc: true
---

## 통신방식

1. 유니 캐스트
* 1:1 통신
* 출발지와 목적지가 1:1
2. 브로드 캐스트
* 1:모든 통신
* `동일 네트워크에 존재하는 모든 호스트`가 목적지
3. 멀티 캐스트
* 1:그룹
* 하나의 출발지에서 다수의 `특정 목적지`
4. 애니 캐스트
* 1:1 통신
* 다수의 동일 그룹 중 `가장 가까운 호스트`에서 응답

## MAC 주소

2계층에서 통신을 위해 `네트워크 인터페이스에 할당된 고유 식별자.` 네트워크에 접속하는 모든 장비는 MAC주소를 가지고 있어야한다.

## IP 주소

3계층에서 통신을 위한 `논리적인 주소`

특징
* 사용자가 변경 가능
* 주소에 레벨이 있다(어떤 네트워크인지를 나타내는 네트워크 주소, 호스트 주소)

### IP 주소 체계

8비트.8비트.8비트.8비트

각각의 8비트 덩어리는 `옥텟`이라고 불린다.

### 클래스리스 네트워크

클래스로 네트워크를 분류하니까 늘어난 IP주소를 감당할수가 없어서 개발되었다.

클래스리스 네트워크에서는 네트워크와 호스트 주소를 나누는 구분자를 사용해야하는데 이 구분자를 `서브넷 마스크`라고 부른다.

#### 서브넷 마스크

2진수 1은 네크워크 주소를, 0은 호스트 주소를 표시한다.
> 2진수로 표현된 IP와 2진수로 표현된 서브넷마스크 주소를 AND 연산을 하면 네크워크 주소를 알아낼수 있다.
{: .prompt-info }

#### 서브네팅: 기존의 클래스 네트워크를 더 쪼개서 사용(IP할당)을 할 수 있는 방법.
IP주소와 서브넷마스크가 주어졌다고 생각하자.
1. IP주소와 서브넷 마스크를 2진수로 표현한다.
2. IP주소와 서브넷 마스크를 AND 연산하여 나온 주소가 해당 IP가 속하는 `네크워크 주소`이다.
3. 2에서 얻은 네크워크 주소에 +1을 한게 `첫번째 주소`
4. 2에서 얻은 호스트 주소영역을 모두 2진수 1로 바꾼게, `브로드 캐스트 주소`
5. 4에서 얻은 브로드 캐스트 주소 - 1 이 `마지막 주소` 이다.

### 공인 IP, 사설 IP

인터넷에 접속할때 IP주소가 필요하고 이 IP주소는 `전세계에서 유일해야한다` 이런 주소를 공인 IP라고 한다. 하지만 네트워크에 접속하는 모든 장비에 공인 IP를 할당한다면 IP주소가 금방 고갈되고 말것이다. 이를 위해 NAT등의 기술을 이용해서 사설 IP를 제공할수 있다.
> 내부망을 구축할때, NAT에서 사용되는 공인 IP를 다른 회사의 네트워크에서 사용하는 IP를 사용하면 안된다. 다른 회사의 네트워크에서 우리쪽 NAT 공인 IP와 통신하려고 하면, 다른 회사 내부 네트워크로 연결된다.
{: .prompt-info }

## TCP/UDP

4계층(트랜스포트계층)에서 작동하는 프로토콜이다. `목적지 프로세스를 정확히 찾아가고, 패킷순서가 바뀌지 않도록 하는 역할을 한다.`

### TCP

정보유실이 없는 통신을 보장하기 위해 세션을 안전하게 연결하고 데이터를 분할하고 분할된 패킷이 잘 전송되었는지 확인하는 기능이 있다.
> 이를 위해 패킷에 번호 (seq num)을 부여하고 잘 도착했는지 응답 (ack)한다. 
{: .prompt-info }

#### 3-way handshake

TCP는 본격적인 통신을 하기 전, 3번의 패킷을 주고 받는 사전 연결작업을 한다.

server가 listen 상태이다.
1. 클라이언트가 server에 SYN 패킷을 보내고 상태를 SYN-SENT로 변경한다.
2. 서버는 SYN-RECEIVE 상태로 변경하고 SYN+ACK를 보낸다.
3. 클라이언트는 ESTABLISHED 상태로 변경하고 ACK를 서버로 보낸다.
4. 서버는 ACK를 받고 ESTABLISHED 상태로 변경하고 본격적인 통신을 시작한다.

> TCP 플래그의 종류는 SYN, ACK, FIN, RST, URG, PSH 등이 있다.
{: .prompt-info }

### UDP

UDP는 신뢰성은 고려하지 않고 데이터 전송을 보장하지는 않는다. 주로 실시간스트리밍과 같이 응답의 신뢰성보다는 시간에 민감한 곳에서 많이 쓰인다.

## ARP: IP와 MAC의 연결고리

사실 MAC과 IP에는 아무런 관계가 없다. 실제로 통신은 MAC이 아닌 IP주소로 일어난다. 이때 IP주소와 연결된 MAC주소를 통신하는 입장에서 알아야할 필요가 있는데, 이때 ARP 프로토콜이 사용된다. 테이블로 유지하고 캐싱한다.

## 서브넷/게이트웨이

원격지 네트워크와 통신하려면 게이트웨이가 필요하고 해당 역할은 3계층 장비인 라우터나 L3 스위치가 수행할수 있다.
> 로컬 네트워크에서는 ARP 브로드캐스트를 이용해 도착지의 MAC주소를 알아낼수 있지만, 브로드캐스트는 네트워크를 넘어 전달될수 없기 때문에 게이트웨이가 필요하다.
{: .prompt-info }

