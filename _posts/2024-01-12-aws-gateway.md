---
title: AWS 네트워크 - NAT gateway, Internet gateway 차이
categories: ["AWS", "NETWORK"]
date: 2024-01-12
tags: ['networking', 'aws']     # TAG names should always be lowercase
toc: true
---

AWS의 NAT gateway와 Internet gateway의 차이점을 까먹기 싫어서 정리해둔 문서

## Routing Table

NAT gateway와 Internet gateway를 알아보기전에, `라우팅 테이블`이라는 리소스를 알고 있어야한다. `라우팅 테이블`은 네트워크상의 경로 정보가 저장되어 있는 테이블이다. 일반적인 온프레미스 환경이라면 라우터와 같은 네트워크 기기에 설정을 해야하지만, AWS에서는 `VPC에 라우팅 테이블을 생성하고, 각 서브넷에 사용 할 라우팅 테이블을 지정한다.`

VPC를 통해 주고 받는 패킷은 모두 이 라우팅 테이블의 경로 정보를 기반으로 어디로 통신할지 정해진다.
> 외부와 통신하기 위해서는 보통 `0.0.0.0/0`을 대상으로 하는 경로가 필요하다. 이 경로는 퍼블릭 서브넷에서는 인터넷 게이트웨이를 가리키고, 프라이빗 서브넷에서는 NAT 게이트웨이(NAT Gateway)를 가리키게 된다
{: .prompt-tip }

## Internet gateway

인터넷 게이트웨이는 `퍼블릭 서브넷`에 있는 인스턴스들이 인터넷에 `양방향`으로 접근할 수 있도록 해주는 리소스다. 이를 사용하기 위해서는 해당 인터넷 게이트웨이로 향하는 경로 정보를 라우팅 테이블에 추가하고, 해당 정보가 저장된 라우팅 테이블을 퍼블릭 서브넷에 지정한다. 

퍼블릭 서브넷에 있는 인스턴스가 외부와 통신을 하려고하면, 지정된 라우팅 테이블에 저장된 경로(인터넷 게이트웨이)로 패킷이 전송되고, 인터넷 게이트웨이는 해당 패킷을 외부에 흘려보내서 외부와 통신하게 된다. 통신을 하려고 하는 주체가 EC2일 경우 퍼블릭 IP 또는 Elastic IP를 이용해서 통신한다.
> Elastic IP는 고정 IP를 사용하지만, 할당만 하고 사용하지 않으면 비용이 발생한다. 퍼블릭 IP는 EC2를 재부팅할 때마다 변경된다.
{: .prompt-warning }

## NAT gateway
NAT 게이트웨이는 `프라이빗 서브넷`에 있는 인스턴스들이 인터넷에 `단방향`으로 접근할 수 있도록 해주는 리소스다. 이를 사용하기 위해서는 해당 NAT 게이트웨이로 향하는 경로 정보를 라우팅 테이블에 추가하고, 해당 정보가 저장된 라우팅 테이블을 프라이빗 서브넷에 지정한다. 가장 중요한 부분은 `단방향`으로 통신이 가능하다는 점이다. NAT 게이트웨이는 내부에서 외부로 나가는 연결만 허용하며, 외부에서 내부로 들어오는 패킷은 모두 버린다.

통신을 하려고 하는 주체가 EC2일 경우 IP가 필요한데, 프라이빗 서브넷에 있는 리소스들은 공인 IP가 없다. 이를 위해 NAT gateway에 IP를 할당하여, 말그대로 NAT 역할을 수행하게 된다. 이를 통해 출발지 IP는 모두 NAT gateway에 할당된 IP로 바뀌게 된다.

