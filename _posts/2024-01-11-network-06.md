---
title: 네트워크 - NAT, DNS, GSLB, DHCP
date: 2024-01-11
categories: ["NETWORK"]
tags: ['networking']     # TAG names should always be lowercase
toc: true
---

## NAT (Network ADDress Translation): IP 주소를 다른 IP 주소로 변환해 라우팅을 원활히 해주는 기술

기본적으로 하나의 네트워크 주소에 다른 하나의 네트워크 주소로 변환하는 1:1 변환이 기본이지만 IP 주소가 고갈되는 문제를 해결 하기 위해 여러개의 IP를 하나의 IP로 변환하는 기술이다.

NAT가 필요한 이유는 크게 다음과 같다.
1. IPv4 주소 고갈 문제
2. 보안 강화: 내부 IP주소를 외부에 감출수 있다.
3. IP 주소 체계가 같은 두 개의 네트워크 간 통신을 가능하게 해준다.
4. 불필요한 설정 변경을 줄일 수 있다.

### NAT 동작 방식

1. 사용자가 웹서버에 접근하기 위해 출발지 IP를 1.1.1.1 으로 목적지 IP와 서비스 포트는 2.2.2.2 80으로 패킷을 전송한다. 출발지 서비스 포트는 임의의 포트로 할당된다. 
2. NAT 역할을 수행하는 장비에서는 사용자가 송신한 패킷을 수신한 후, NAT 정책에 따라 외부 네트워크와 통신이 가능한 공인 IP인 3.3.3.3으로 IP 주소를 변경한다. 이때 변경 정보는 NAT 테이블에 저장된다.
3. NAT 장비에서 출발지 주소를 11.11.11.11로 변경해 목적지 웹서버로 전송한다.
4. 웹서버에서는 사용자에게 응답을 보낸다. 목적지 IP는 11.11.11.11 이다.
5. NAT는 웹서버로 부터 응답 패킷을 수신하고, 목적지 IP에 대한 패킷을 발생시킨 IP를 확인한다.(1.1.1.1)
6. NAT 변환 테이블에서 목적지 IP를 원래 IP로 변경하고, 사용자에게 전송한다.
> 여기서 포트 번호 까지 변경하면 PAT이다.
{: .prompt-tip }

#### SNAT/DNAT

* SNAT: 출발지 주소를 변경하는 NAT
* DNAT: 도착지 주소를 변경하는 NAT

## DNS(Domain Name Service)

DNS는 데이터 프로토콜이 잘 동작하도록 도와주는 컨트롤 프로토콜이다. 컨트롤 프로토콜은 통신에 직접적으로 관여하진 않지만 처음 통신을 맺을때 도움을 준다. DNS는 문자열로 된 도메인 주소와 IP주소를 연관지어주는 프로토콜이다. 

### DNS 동작 방식

도메인을 쿼리하면 DNS 서버에 쿼리를 하기전, 로컬에 있는 DNS캐시 정보를 먼저 확인한다. 그 후에 DNS서버에 쿼리한다.
만약 쿼리를 받은 DNS서버가 해당 도메인에 대한 정보를 가지고 있지 않다면, 다른 DNS 서버에 질의하여 결과를 받을 수 있다.

DNS 서버는 일반적으로 마스터 서버와 슬레이브 서버로 나뉠수 있다. 하지만 마스터 서버가 우선순위가 더 높지 않고 두 서버 모두 도메인 쿼리에 응답한다. 
> DNS서버의 마스터 서버와 슬레이브 서버는 이중화에서 일반적으로 사용하는 액티브-스탠바이나 액티브-액티브 형태로 구성하지 않는다. 마스터 서버에 문제가 발생하고 일정시간이 지나면 슬레이브 서버도 도메인에 대해 정상적으로 응답할 수 없다.
{: .prompt-warning }

### DNS 주요 레코드

* A: 도메인 주소를 IP로 매핑
* AAAA: 도메인 주소를 IPv6로 매핑
* CNAME: 도메인 주소에 대한 별칭
    
    레코드 값에 IP주소를 매핑하는 A 레코드와 달리 CNAME 레코드는 레코드 값에 도메인 주소를 매핑한다.

* SOA: 본 영역 데이터에 대한 권한
* NS: 본 영역에 대한 네임 서버
* MX: 도메인에 대한 메일 서버 정보
* TXT: 도메인에 대한 일반 텍스트

## GSLB

DNS에서 동일한 레코드 이름으로 서로 다른 IP 주소를 매핑하여 로드밸런싱 할 수 있다. 하지만 이때 DNS는 설정된 서비스 상태의 정상여부를 체크하지 않고 도메인에 대한 질의에 응답하므로 정상적으로 로드밸런싱 할 수 없다. GSLB는 DNS의 이런 문제점을 해결해 도메인을 이용하여 로드밸런싱을 구현 할 수 있도록 도와준다.

GSLB는 DNS와 동일하게 도메인 질의에 응답해주는 역할과 동시에 로드 밸런서 처럼 등록된 도메인에 연결된 서비스가 정상적인지 헬스체크를 수행한다. 이러한 GSLB의 구성방식은 두가지가 있다.
1. 도메인 자체를 GSLB로 사용
2. 도메인 내의 특정 레코드는 GSLB를 사용

## DHCP

호스트가 네트워크와 통신하려면 물리적 네트워크 구성과 IP 주소, 서브넷 마스크, 게이트웨이와 같은 네트워크 정보와 DNS 주소도 구성이 필요하다. 이때 IP를 동적으로 할당하는 것에 사용되는 프로토콜이 DHCP이다.