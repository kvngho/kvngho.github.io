---
title: 네트워크 장비
date: 2024-01-08
categories: ["NETWORK"]
tags: ['networking']     # TAG names should always be lowercase
toc: true
---

## 스위치 (2계층 장비)

기본적으로 스위치는 2계층 장비이며, MAC주소를 기반으로 동작한다.

### 스위치 동작

스위치는 패킷을 동시에 여러개 장비가 서로 간섭없이 통신할수 있도록 도와준다. 스위치는 MAC주소 테이블(다른 단말의 MAC 주소와 단말이 위치하는 인터페이스 정보가 매핑된 테이블)을 가지고 있어서 자신에게 들어온 패킷을 올바른 목적지로 보내줄수 있다.

만약, 자신이 가지고 있는 MAC주소 테이블에 없는 MAC주소가 목적지인 패킷이 들어온다면, 스위치는 전체 포트로 패킷을 전송한다.

#### 플러딩

스위치를 처음 부팅하면, 당연하게도 네트워크 관련 정보가 아무것도 없다. 이때는 스위치는 허브처럼 패킷이 들어온 포트를 제외하고 모든 포트로 패킷을 전달한다. 이러한 전달 방식을 `플러딩`이라고 한다.

#### 어드레스 러닝

앞서 말했듯이, 스위치가 패킷의 목적지 MAC주소를 확인하고 원하는 포트로 패킷을 포워딩하려면 MAC 주소 테이블을 만들고 유지해야한다. 이 과정을 `어드레스 러닝` 이라고 한다. 이를 위해 들어온 패킷의 `출발지 MAC 주소`를 사용한다.

패킷이 특정 포트로 들어오면, 해당 패킷의 출발지 MAC 주소와 특정 포트를 매핑하여 MAC 주소 테이블을 만든다. 
> 이로인해 브로드캐스트나 멀티캐스트에 대한 MAC 주소는 학습할수 없다.(둘다 목적지 MAC 주소만 존재하기때문)
{: .prompt-info }

#### 포워딩/필터링

패킷이 스위치에 들어오면 도착지 MAC 주소를 확인하고 자신이 가진 MAC 테이블과 비교해 맞는 정보가 있으면 해당 포트로 패킷을 `포워딩`하고, 다른 포트로는 패킷을 `필터링`하여 보내지 않는다.

### VLAN: 물리적 배치와 상관없이 LAN을 논리적으로 분할/구성하는 기술

VLAN은 하나의 물리 스위치에서 여러 개의 네트워크를 나누어 사용할수 있게 해주는 기술이다. VLAN으로 네트워크를 나누면 논리적으로 서로 다른 여러개의 네크워크를 가지게 되므로 VLAN간에 유니캐스트나 브로드캐스트도 불가능하다.

* 포트 기반 VLAN
* MAC 주소 기반 VLAN

등이 있다.

#### 포트 기반 VLAN

포트 기반 VLAN에서는 스위치의 각 포트에 각각 사용할 VLAN을 설정하는데, 한 대의 스위치에 연결되더라도 서로 다른 VLAN이 설정된 포트간에는 통신이 불가능하다. (3계층 장비를 사용해야한다.) 이때 스위치끼리의 연결에도 스위치의 포트를 사용해야하는데, 이러면 스위치 장비간의 연결만으로도 많은 포트가 쓰여야 한다. 이러한 문제를 해결하기 위하여 VLAN 태그 기능이 있다.

여러개의 VLAN을 함께 전송할수 있게 해주는 포트들이 있는데, 이걸 `태그 포트`라고 한다.  

### STP(Spanning Tree Protocol)

네트워크에 스위치가 하나만 존재한다면, 해당 스위치가 단일 장애 지점이 될 확률이 존재한다. 이를 위해 스위치 두대로 네트워크를 구성한다면 패킷이 네트워크를 따라 계속 전송되어서 네트워크를 마비시킬수 있다. 이러한 현상을 `네트워크 루프`라고한다. 이러한 루프를 막기위한 메커니즘이 STP이다.
> 네트워크가 루프 구조를 가지게 하는것이 아니라, 나무가 뿌리에서 가지로 뻗어나가는 것처럼 네트워크를 구성하는것이다. 이를 위해 BPDU라는 프로토콜을 사용한다.
{: .prompt-info }


#### 네트워크 루프

네트워크안의 패킷이 고리처럼 되돌아 오는 형태이다. 이러면 네트워크가 마비된다.

##### 브로드캐스트 스톰

만약 루프 구조로 구성된 네트워크에서 연결된 단말이 브로드캐스트를 발생시키면 스위치는 이 패킷을 들어온 포트를 제외한 모든 포트로 플러딩한다. 플러딩된 패킷은 다른 스위치에도 들어가고, 해당 스위치는 또다시 플러딩한다. 이렇게 되면 패킷은 계속 네트워크를 떠돌게 된다. 이러한 현상을 `브로드캐스트 스톰`이라고한다.
> 3계층에서는 TTL 이라는 값을 가지고 있어서 패킷의 수명이 존재한다.
{: .prompt-info }

##### MAC 러닝 중복 문제

루프 구조에서는 브로드캐스트 뿐만아니라 유니캐스트도 문제를 일으킨다. 스위치는 출발지의 MAC 주소를 학습하는데, 직접 전달되는 패킷과 스위치를 돌아서 들어간 패킷 간의 포트가 달라서 MAC 주소를 정상적으로 학습할수 없게된다.